<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>보안 인증</title>
    <link rel="stylesheet" href="../index.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        /* [핵심 수리] index.css의 거대한 모바일 스타일을 억제하고 슬림하게 재조정합니다. */
        
        /* 1. 외부 브라우저 안내 바: 세로 길이를 극한으로 줄인 캡슐 디자인 */
        .external-link-section {
            display: none; 
            width: 100%;
            background: #fee500; 
            padding: 4px 12px !important; /* 세로 두께 최소화 */
            border-radius: 10px;
            margin-bottom: 15px;
            box-sizing: border-box;
            flex-direction: row !important; /* 가로 한 줄 배치 */
            align-items: center;
            justify-content: space-between;
            height: 35px !important; /* 높이 강제 고정 */
        }
        .external-link-section p {
            margin: 0 !important;
            font-size: 11px !important; /* 글자 크기 대폭 축소 */
            color: #3c1e1e !important;
            font-weight: 800 !important;
        }
        .external-btn-mini {
            width: auto !important; 
            height: 24px !important; /* 버튼 높이 아주 낮게 */
            padding: 0 10px !important;
            background: #3c1e1e !important;
            color: white !important;
            font-size: 10px !important;
            border-radius: 6px !important;
            border: none;
            cursor: pointer;
        }

        /* 2. 모바일에서 index.css의 거대한 크기를 강제로 정상화 */
        @media (max-width: 768px) {
            .auth-modal {
                min-height: auto !important; /* 70vh 삭제 */
                padding: 25px 20px !important; /* 80px 패딩 삭제 */
                width: 90% !important;
                border-radius: 25px !important;
            }
            .auth-modal h2 { font-size: 1.4rem !important; } /* 2.5rem에서 축소 */
            .auth-modal p { font-size: 0.9rem !important; margin-bottom: 15px !important; }
            .auth-modal input { 
                height: 45px !important; /* 90px에서 45px로 복구 */
                font-size: 1.1rem !important; 
                margin-bottom: 12px !important;
            }
            .auth-modal button#authBtn { 
                height: 50px !important; /* 90px에서 50px로 복구 */
                font-size: 1.1rem !important; 
            }
            .class-label { padding: 10px 0 !important; font-size: 0.85rem !important; }
        }
    </style>
</head>
<body oncontextmenu="return false" onselectstart="return false" ondragstart="return false">
    <div class="auth-overlay">
        <div class="auth-modal">
            <div class="external-link-section" id="kakaoOnly">
                <p>⚠️ 카톡 이용 중이신가요?</p>
                <button class="external-btn-mini" onclick="exitToExternal()">사파리/크롬 열기</button>
            </div>

            <h2 onclick="handleAdminClick()">학생 인증</h2>
            <p>정보를 정확히 입력하세요.</p>
            
            <div style="text-align:left; font-size:0.8rem; font-weight:700; color:#64748b; margin-bottom:5px; margin-left:5px;">교실 선택</div>
            <div class="class-selector">
                <label class="class-option"><input type="radio" name="classSelect" value="501"><span class="class-label">501</span></label>
                <label class="class-option"><input type="radio" name="classSelect" value="601"><span class="class-label">601</span></label>
                <label class="class-option"><input type="radio" name="classSelect" value="602"><span class="class-label">602</span></label>
                <label class="class-option"><input type="radio" name="classSelect" value="603"><span class="class-label">603</span></label>
                <label class="class-option"><input type="radio" name="classSelect" value="701"><span class="class-label">701</span></label>
                <label class="class-option"><input type="radio" name="classSelect" value="702"><span class="class-label">702</span></label>
                <label class="class-option"><input type="radio" name="classSelect" value="703"><span class="class-label">703</span></label>
            </div>

            <input type="text" id="userNameInput" placeholder="성함 (예: 홍길동)">
            <input type="password" id="pwInput" placeholder="Password">
            
            <button id="authBtn" onclick="handleAuth()">인증 및 시작하기</button>
            <p id="errorMsg" style="display:none; color:red; margin-top:5px; font-size:0.85rem;">정보가 올바르지 않습니다.</p>
        </div>
    </div>

    <script>
    (function() {
        if (navigator.userAgent.toLowerCase().indexOf('kakaotalk') > -1) {
            document.getElementById('kakaoOnly').style.display = 'flex';
        }
    })();

    // [아이폰 확실한 탈출] 카톡 파라미터를 사용한 강제 실행
    function exitToExternal() {
        const targetUrl = window.location.href.split('/start/')[0] + '/index.html';
        const ua = navigator.userAgent.toLowerCase();

        if (ua.indexOf('iphone') > -1 || ua.indexOf('ipad') > -1) {
            // 아이폰 사파리 강제 호출 공식 파라미터
            location.href = targetUrl + (targetUrl.includes('?') ? '&' : '?') + 'open_external_browser=1';
        } else if (ua.indexOf('android') > -1) {
            location.href = 'intent://' + targetUrl.replace(/https?:\/\//i, '') + '#Intent;scheme=http;package=com.android.chrome;end';
        } else {
            window.location.href = targetUrl;
        }
    }

    // [나머지 handleAuth, Firebase 등 기존 로직 그대로 유지]
    </script>
</body>
</html>